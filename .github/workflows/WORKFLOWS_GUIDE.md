# GitHub Actions Workflows ä½¿ç”¨æŒ‡å—

æœ¬é¡¹ç›®åŒ…å«ä¸‰ä¸ª GitHub Actions å·¥ä½œæµï¼Œç”¨äºè‡ªåŠ¨åŒ–æ„å»ºå’Œå‘å¸ƒ Auto Cursor åº”ç”¨ç¨‹åºã€‚

---

## ğŸ“‹ å·¥ä½œæµæ¦‚è§ˆ

| å·¥ä½œæµæ–‡ä»¶ | ç”¨é€” | è§¦å‘æ–¹å¼ | æ„å»ºå¹³å° |
|-----------|------|---------|---------|
| `build.yml` | åŸºç¡€æ„å»ºå’Œå‘å¸ƒ | æ‰‹åŠ¨è§¦å‘ | Linux, Windows |
| `quick-build.yml` | å¿«é€Ÿæ„å»ºå•å¹³å° | æ‰‹åŠ¨è§¦å‘ï¼ˆå¯é€‰å¹³å°ï¼‰ | ä»»æ„å•ä¸ªå¹³å° |
| `release-to-public.yml` | å‘å¸ƒåˆ°å…¬å¼€ä»“åº“ | Tag æ¨é€æˆ–æ‰‹åŠ¨ | Linux, Windows |

---

## 1ï¸âƒ£ build.yml - åŸºç¡€æ„å»ºå’Œå‘å¸ƒ

### åŠŸèƒ½è¯´æ˜
è¿™æ˜¯ä¸»è¦çš„æ„å»ºå·¥ä½œæµï¼Œç”¨äºæ„å»ºå¤šå¹³å°åº”ç”¨å¹¶åˆ›å»º GitHub Releaseã€‚

### è§¦å‘æ¡ä»¶
```yaml
workflow_dispatch  # æ‰‹åŠ¨è§¦å‘
```

### æ„å»ºå¹³å°
- âœ… **Linux x64** (Ubuntu 22.04)
- âœ… **Windows x64** (Windows Latest)
- âš ï¸ **macOS** (å·²æ³¨é‡Šï¼Œæš‚ä¸æ”¯æŒ)

### æ„å»ºäº§ç‰©
| å¹³å° | æ–‡ä»¶ç±»å‹ | æ–‡ä»¶åç¤ºä¾‹ |
|------|---------|-----------|
| Linux | `.deb`, `.AppImage` | `auto-cursor_x86_64.deb` |
| Windows | `.exe`, `.msi` | `auto-cursor.exe` |

### ä½¿ç”¨æ­¥éª¤

#### æ–¹æ³•1ï¼šé€šè¿‡ GitHub ç½‘é¡µç•Œé¢
1. è®¿é—®ä»“åº“çš„ **Actions** æ ‡ç­¾é¡µ
2. ç‚¹å‡»å·¦ä¾§ **"Build and Release"**
3. ç‚¹å‡»å³ä¾§ **"Run workflow"** æŒ‰é’®
4. é€‰æ‹©åˆ†æ”¯ï¼ˆé€šå¸¸æ˜¯ `main`ï¼‰
5. ç‚¹å‡» **"Run workflow"** ç¡®è®¤

#### æ–¹æ³•2ï¼šé€šè¿‡ GitHub CLI
```bash
gh workflow run build.yml
```

### äº§ç‰©ä¸‹è½½

#### ä¸‹è½½æ­¥éª¤
1. åœ¨ **Actions** é¡µé¢æ‰¾åˆ°å¯¹åº”çš„ workflow è¿è¡Œè®°å½•
2. ç‚¹å‡»è¿›å…¥è¿è¡Œè¯¦æƒ…é¡µé¢
3. å‘ä¸‹æ»šåŠ¨åˆ°é¡µé¢åº•éƒ¨çš„ **Artifacts** åŒºåŸŸ
4. ç‚¹å‡»å¯¹åº”å¹³å°çš„ artifact åç§°è¿›è¡Œä¸‹è½½
5. ä¸‹è½½çš„æ˜¯ `.zip` å‹ç¼©æ–‡ä»¶ï¼Œè§£å‹åå³å¯æ‰¾åˆ°å®‰è£…åŒ…

#### äº§ç‰©æ–‡ä»¶åæ ¼å¼
- `auto-cursor-{å¹³å°}-{æ¶æ„}.zip`
  - ä¾‹å¦‚ï¼š`auto-cursor-linux-x86_64.zip`
  - ä¾‹å¦‚ï¼š`auto-cursor-windows-x86_64.zip`

#### Artifacts ä½ç½®è¯´æ˜
```
GitHub Actions è¿è¡Œé¡µé¢
  â””â”€ Summary (æ‘˜è¦)
  â””â”€ Jobs (ä»»åŠ¡åˆ—è¡¨)
  â””â”€ Run details (è¿è¡Œè¯¦æƒ…)
  â””â”€ Annotations (æ³¨é‡Š/è­¦å‘Š)
  â””â”€ Artifacts â† åœ¨è¿™é‡Œï¼æ„å»ºå®Œæˆåä¼šæ˜¾ç¤ºå¯ä¸‹è½½çš„æ–‡ä»¶
```

### å·¥ä½œæµç¨‹å›¾
```
1. æ‹‰å–ä»£ç  (Checkout)
   â†“
2. å®‰è£… Node.js + pnpm
   â†“
3. å®‰è£…å‰ç«¯ä¾èµ– (pnpm install)
   â†“
4. å®‰è£… Rust å·¥å…·é“¾
   â†“
5. å®‰è£…å¹³å°ä¾èµ– (Linux only)
   â†“
6. æ„å»ºå‰ç«¯ (pnpm build)
   â†“
7. æ¸…ç†ä¸éœ€è¦çš„å¹³å°æ–‡ä»¶
   â†“
8. æ„å»º Tauri åº”ç”¨
   â†“
9. å‡†å¤‡æ„å»ºäº§ç‰©
   â†“
10. ä¸Šä¼ åˆ° Artifacts
```

---

## 2ï¸âƒ£ quick-build.yml - å¿«é€Ÿæ„å»ºå•å¹³å°

### åŠŸèƒ½è¯´æ˜
å¿«é€Ÿæ„å»ºå·¥å…·ï¼Œé€‚åˆå¼€å‘é˜¶æ®µæµ‹è¯•å•ä¸ªå¹³å°çš„æ„å»ºã€‚

### è§¦å‘æ¡ä»¶
```yaml
workflow_dispatch  # æ‰‹åŠ¨è§¦å‘ï¼Œå¸¦å¹³å°é€‰æ‹©å‚æ•°
```

### å¹³å°é€‰é¡¹
- `current` (é»˜è®¤) - **é»˜è®¤æ„å»º Windows x64** ç‰ˆæœ¬
- `linux` - Linux x64
- `windows` - Windows x64
- ~~`macos-intel`~~ (å·²æ³¨é‡Š)
- ~~`macos-m1`~~ (å·²æ³¨é‡Š)

> **ğŸ’¡ æç¤º**ï¼š`current` é€‰é¡¹ç°åœ¨é»˜è®¤æ„å»º Windows ç‰ˆæœ¬ï¼Œå› ä¸ºè¿™æ˜¯æœ€å¸¸ç”¨çš„å¹³å°ã€‚å¦‚æœéœ€è¦å…¶ä»–å¹³å°ï¼Œè¯·æ˜ç¡®é€‰æ‹© `linux` æˆ– `windows`ã€‚

### ä½¿ç”¨æ­¥éª¤

#### æ–¹æ³•1ï¼šé€šè¿‡ GitHub ç½‘é¡µç•Œé¢
1. è®¿é—® **Actions** â†’ **"Quick Build (Current Platform)"**
2. ç‚¹å‡» **"Run workflow"**
3. åœ¨ **"Platform to build for"** ä¸‹æ‹‰èœå•ä¸­é€‰æ‹©å¹³å°ï¼š
   - `current` - **æ„å»º Windows x64**ï¼ˆé»˜è®¤æ¨èï¼‰
   - `linux` - æ„å»º Linux ç‰ˆæœ¬
   - `windows` - æ„å»º Windows ç‰ˆæœ¬ï¼ˆä¸ current ç›¸åŒï¼‰
4. ç‚¹å‡» **"Run workflow"** ç¡®è®¤

#### æ–¹æ³•2ï¼šé€šè¿‡ GitHub CLI
```bash
# æ„å»ºå½“å‰å¹³å°
gh workflow run quick-build.yml

# æ„å»ºæŒ‡å®šå¹³å°
gh workflow run quick-build.yml -f platform=linux
gh workflow run quick-build.yml -f platform=windows
```

### äº§ç‰©ä¸‹è½½

#### ä¸‹è½½æ­¥éª¤ï¼ˆå›¾æ–‡è¯´æ˜ï¼‰
1. åœ¨ **Actions** é¡µé¢æ‰¾åˆ°ä½ è¿è¡Œçš„ workflow
2. ç‚¹å‡»è¿›å…¥è¿è¡Œè¯¦æƒ…é¡µé¢
3. å‘ä¸‹æ»šåŠ¨æ‰¾åˆ° **Artifacts** åŒºåŸŸ
4. ç‚¹å‡» artifact åç§°ï¼ˆå¦‚ `auto-cursor-quick-build-linux`ï¼‰ä¸‹è½½
5. ä¸‹è½½çš„æ˜¯ä¸€ä¸ª `.zip` æ–‡ä»¶ï¼Œè§£å‹åå¯ä»¥æ‰¾åˆ°å®‰è£…åŒ…

#### äº§ç‰©æ–‡ä»¶åæ ¼å¼
- `auto-cursor-quick-build-{å¹³å°}.zip`

#### å¦‚æœæ˜¾ç¤º "No artifacts"
è¿™æ˜¯å› ä¸ºæ„å»ºè¿‡ç¨‹ä¸­æ²¡æœ‰æ‰¾åˆ°äº§ç‰©æ–‡ä»¶ã€‚è¯·æ£€æŸ¥ï¼š
- æ„å»ºæ—¥å¿—ä¸­æ˜¯å¦æœ‰é”™è¯¯
- Tauri æ„å»ºæ­¥éª¤æ˜¯å¦æˆåŠŸå®Œæˆ
- æ›´æ–°åˆ°æœ€æ–°ç‰ˆæœ¬çš„ workflow æ–‡ä»¶ï¼ˆå·²ä¿®å¤äº§ç‰©æ”¶é›†é—®é¢˜ï¼‰

### é€‚ç”¨åœºæ™¯
- âœ… å¿«é€Ÿæµ‹è¯•æ„å»ºæ˜¯å¦æˆåŠŸ
- âœ… å¼€å‘é˜¶æ®µéªŒè¯å•ä¸ªå¹³å°
- âœ… èŠ‚çœ CI/CD æ—¶é—´ï¼ˆä¸æ„å»ºæ‰€æœ‰å¹³å°ï¼‰
- âŒ ä¸é€‚åˆæ­£å¼å‘å¸ƒ

---

## 3ï¸âƒ£ release-to-public.yml - å‘å¸ƒåˆ°å…¬å¼€ä»“åº“

### åŠŸèƒ½è¯´æ˜
è‡ªåŠ¨æ„å»ºå¹¶å‘å¸ƒåˆ°å…¬å¼€çš„ GitHub ä»“åº“ï¼Œç”¨äºåˆ†å‘ç»™ç”¨æˆ·ä¸‹è½½ã€‚

### è§¦å‘æ¡ä»¶
```yaml
push:
  tags: ["v*"]     # Tag æ¨é€è§¦å‘ (å¦‚ v1.0.0)
workflow_dispatch  # æ‰‹åŠ¨è§¦å‘
```

### æ„å»ºå¹³å°
- âœ… **Linux x64**
- âœ… **Windows x64**

### ä½¿ç”¨æ­¥éª¤

#### æ–¹æ³•1ï¼šé€šè¿‡ Git Tag è‡ªåŠ¨è§¦å‘ï¼ˆæ¨èï¼‰
```bash
# 1. åˆ›å»ºç‰ˆæœ¬æ ‡ç­¾
git tag v1.0.0

# 2. æ¨é€æ ‡ç­¾åˆ° GitHub
git push origin v1.0.0

# 3. GitHub Actions è‡ªåŠ¨è§¦å‘æ„å»ºå’Œå‘å¸ƒ
```

#### æ–¹æ³•2ï¼šæ‰‹åŠ¨è§¦å‘
1. è®¿é—® **Actions** â†’ **"Release to Public Repository"**
2. ç‚¹å‡» **"Run workflow"**
3. é€‰æ‹©åˆ†æ”¯
4. ç‚¹å‡» **"Run workflow"** ç¡®è®¤

### å‘å¸ƒç›®æ ‡
- **å…¬å¼€ä»“åº“**: `wuqi-y/auto-cursor-releases`
- **Release å†…å®¹**:
  - è‡ªåŠ¨ç”Ÿæˆçš„ Release Notes
  - å„å¹³å°å®‰è£…åŒ…
  - å®‰è£…è¯´æ˜æ–‡æ¡£

### å‰ç½®é…ç½®è¦æ±‚

#### éœ€è¦é…ç½®çš„ Secret
åœ¨ä»“åº“çš„ **Settings** â†’ **Secrets and variables** â†’ **Actions** ä¸­æ·»åŠ ï¼š

| Secret åç§° | è¯´æ˜ | è·å–æ–¹å¼ |
|------------|------|---------|
| `PUBLIC_REPO_TOKEN` | å…¬å¼€ä»“åº“çš„è®¿é—®ä»¤ç‰Œ | [åˆ›å»º Personal Access Token](https://github.com/settings/tokens) |

#### Token æƒé™è¦æ±‚
åˆ›å»º Personal Access Token æ—¶éœ€è¦å‹¾é€‰ï¼š
- âœ… `repo` (å®Œæ•´ä»“åº“è®¿é—®æƒé™)
- âœ… `write:packages` (å¦‚æœéœ€è¦å‘å¸ƒåŒ…)

#### é…ç½®æ­¥éª¤
1. è®¿é—® [GitHub Token è®¾ç½®](https://github.com/settings/tokens/new)
2. å¡«å†™ Token æè¿°ï¼š`Auto Cursor Release Token`
3. é€‰æ‹©è¿‡æœŸæ—¶é—´ï¼ˆå»ºè®®ï¼š1å¹´æˆ–æ— è¿‡æœŸï¼‰
4. å‹¾é€‰ `repo` æƒé™
5. ç‚¹å‡» **"Generate token"**
6. å¤åˆ¶ç”Ÿæˆçš„ Token
7. å‰å¾€ä»“åº“ **Settings** â†’ **Secrets** â†’ **New repository secret**
8. Name: `PUBLIC_REPO_TOKEN`
9. Value: ç²˜è´´åˆšæ‰å¤åˆ¶çš„ Token
10. ç‚¹å‡» **"Add secret"**

### ä¿®æ”¹å…¬å¼€ä»“åº“åœ°å€
å¦‚æœéœ€è¦ä¿®æ”¹å‘å¸ƒç›®æ ‡ä»“åº“ï¼Œç¼–è¾‘ `release-to-public.yml`:

```yaml
# ç¬¬ 191 è¡Œ
repository: wuqi-y/auto-cursor-releases  # æ”¹ä¸ºä½ çš„ä»“åº“åœ°å€
```

---

## ğŸ”§ é€šç”¨é…ç½®è¯´æ˜

### pyBuild ç›®å½•æ¸…ç†
æ‰€æœ‰å·¥ä½œæµéƒ½ä¼šæ¸…ç†ä¸éœ€è¦çš„å¹³å°æ–‡ä»¶ï¼š

```bash
# æ„å»º Linux æ—¶ï¼Œåˆ é™¤ macOS å’Œ Windows çš„ pyBuild
# æ„å»º Windows æ—¶ï¼Œåˆ é™¤ macOS å’Œ Linux çš„ pyBuild
# ç›®çš„ï¼šå‡å°æœ€ç»ˆæ„å»ºåŒ…å¤§å°
```

### Rust ç¼“å­˜
ä½¿ç”¨ `swatinem/rust-cache@v2` åŠ é€Ÿæ„å»ºï¼š
- è‡ªåŠ¨ç¼“å­˜ Cargo ä¾èµ–
- å¤§å¹…ç¼©çŸ­æ„å»ºæ—¶é—´

### ä¾èµ–ç‰ˆæœ¬
| å·¥å…· | ç‰ˆæœ¬ |
|------|------|
| Node.js | 20 |
| pnpm | 8 |
| Rust | stable |

---

## ğŸ“Š å·¥ä½œæµå¯¹æ¯”

| ç‰¹æ€§ | build.yml | quick-build.yml | release-to-public.yml |
|------|-----------|----------------|----------------------|
| å¤šå¹³å°æ„å»º | âœ… | âŒ | âœ… |
| åˆ›å»º Release | âœ… (Tagæ—¶) | âŒ | âœ… |
| å‘å¸ƒåˆ°å…¬å¼€ä»“åº“ | âŒ | âŒ | âœ… |
| æ„å»ºé€Ÿåº¦ | æ…¢ | å¿« | æ…¢ |
| é€‚ç”¨åœºæ™¯ | æ­£å¼æ„å»º | å¼€å‘æµ‹è¯• | å…¬å¼€å‘å¸ƒ |

---

## ğŸ¯ ä½¿ç”¨å»ºè®®

### å¼€å‘é˜¶æ®µ
```bash
# ä½¿ç”¨ quick-build å¿«é€ŸéªŒè¯
gh workflow run quick-build.yml -f platform=linux
```

### å‡†å¤‡å‘å¸ƒ
```bash
# 1. æ›´æ–°ç‰ˆæœ¬å·ï¼ˆå¦‚åœ¨ package.json, Cargo.toml ç­‰ï¼‰
# 2. æäº¤ä»£ç 
git add .
git commit -m "chore: bump version to 1.0.0"

# 3. åˆ›å»ºå¹¶æ¨é€ tag
git tag v1.0.0
git push origin v1.0.0

# 4. release-to-public.yml è‡ªåŠ¨è§¦å‘
```

### æµ‹è¯•æ„å»º
```bash
# æ‰‹åŠ¨è§¦å‘å®Œæ•´æ„å»ºï¼ˆä¸å‘å¸ƒï¼‰
gh workflow run build.yml
```

---

## ğŸ› æ•…éšœæ’æŸ¥

### é—®é¢˜1ï¼šæ„å»ºå¤±è´¥ - ä¾èµ–å®‰è£…é”™è¯¯
**è§£å†³æ–¹æ¡ˆ**ï¼š
- æ£€æŸ¥ `pnpm-lock.yaml` æ˜¯å¦æäº¤
- ç¡®ä¿ `package.json` ä¸­çš„ä¾èµ–ç‰ˆæœ¬æ­£ç¡®

### é—®é¢˜2ï¼šRust ç¼–è¯‘é”™è¯¯
**è§£å†³æ–¹æ¡ˆ**ï¼š
- æ£€æŸ¥ `Cargo.toml` é…ç½®
- æŸ¥çœ‹ `src-tauri/` ä¸‹çš„ Rust ä»£ç æ˜¯å¦æœ‰è¯­æ³•é”™è¯¯

### é—®é¢˜3ï¼šå‘å¸ƒåˆ°å…¬å¼€ä»“åº“å¤±è´¥
**è§£å†³æ–¹æ¡ˆ**ï¼š
- æ£€æŸ¥ `PUBLIC_REPO_TOKEN` æ˜¯å¦é…ç½®
- éªŒè¯ Token æƒé™æ˜¯å¦æ­£ç¡®
- ç¡®è®¤å…¬å¼€ä»“åº“åœ°å€æ˜¯å¦å­˜åœ¨

### é—®é¢˜4ï¼šmacOS æ„å»ºå¤±è´¥
**åŸå› **ï¼šmacOS æ„å»ºå·²è¢«æ³¨é‡Šç¦ç”¨
**è§£å†³æ–¹æ¡ˆ**ï¼š
- å¦‚éœ€å¯ç”¨ï¼Œå–æ¶ˆ `build.yml` ä¸­ macOS ç›¸å…³è¡Œçš„æ³¨é‡Š
- æ³¨æ„ï¼šmacOS æ„å»ºéœ€è¦ Apple å¼€å‘è€…è¯ä¹¦ç­¾å

---

## ğŸ“ ä¿®æ”¹å»ºè®®

### å¯ç”¨ macOS æ„å»º
1. ç¼–è¾‘ `build.yml` å’Œ `release-to-public.yml`
2. å–æ¶ˆç¬¬ 20-29 è¡Œçš„æ³¨é‡Š
3. é…ç½® Apple å¼€å‘è€…è¯ä¹¦ï¼ˆå¦‚éœ€ç­¾åï¼‰

### æ·»åŠ è‡ªåŠ¨å‘å¸ƒåˆ° Release
å¦‚æœå¸Œæœ› `build.yml` ä¹Ÿèƒ½åˆ›å»º Releaseï¼š
```yaml
# å–æ¶ˆ build.yml ç¬¬ 3-5 è¡Œçš„æ³¨é‡Š
on:
  push:
    tags: ["v*"]
```

### è‡ªå®šä¹‰æ„å»ºå‚æ•°
ä¿®æ”¹ Tauri æ„å»ºå‚æ•°ï¼š
```yaml
# åœ¨ Build Tauri app æ­¥éª¤ä¸­æ·»åŠ 
with:
  args: ${{ matrix.args }} --verbose  # æ·»åŠ è¯¦ç»†è¾“å‡º
```

---

## ğŸ”— ç›¸å…³é“¾æ¥

- [Tauri GitHub Actions æ–‡æ¡£](https://tauri.app/v1/guides/building/cross-platform)
- [GitHub Actions æ–‡æ¡£](https://docs.github.com/en/actions)
- [pnpm æ–‡æ¡£](https://pnpm.io/)
- [Rust å·¥å…·é“¾æ–‡æ¡£](https://rust-lang.github.io/rustup/)

